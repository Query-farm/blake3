# name: test/sql/blake3.test
# description: test blake3 extension
# group: [sql]

# Before we load the extension, this will fail
statement error
SELECT blake3('test' order by 1);
----
Catalog Error: Scalar Function with name blake3 does not exist!

# Require statement will ensure this test is run with this extension loaded
require blake3

# Confirm the extension works
query I
SELECT to_hex(blake3('hello world' order by 1));
----
4D70CA83D92FED8E3D510D612BD6F2D1E4675E2DAFD26E0960B71818D08C8B23

statement ok
CREATE TABLE test_data as (select * as v from range(10000));

query I
SELECT to_hex(blake3(v::varchar order by v)) from test_data
----
96DACC49D55FF97375EE96443CC3CAB4062A06796A20B09165042C61CC30754C

query I
SELECT to_hex(blake3(v::varchar order by v desc)) from test_data
----
5DC193976B04AB4A3772ECDC659AB3102AC3D575683BA570F72A0790478AD391

query I
SELECT to_hex(blake3(v order by v desc)) from test_data;
----
E95B09A633851F4CDD612A6AC7DC7BE408C2D385A2F0579E1DF26D4E9270B43C

# Test different numeric types
query I
SELECT to_hex(blake3(v::tinyint order by v)) from (select * as v from range(10) as v);
----
87FCF07CAC5BE3C91735B34E535C67286E4E7A63BF152D95F2CF4CD1A244758B

query I
SELECT to_hex(blake3(v::smallint order by v)) from (select * as v from range(10) as v);
----
406BA820BBB7D01B5959469B3A816FC97243AC6C4419F277BBAC8F76CF0582EE

query I
SELECT to_hex(blake3(v::integer order by v)) from (select * as v from range(10) as v);
----
9138FC91A15A05BD7120EA8ECC57B347BE0205E008DA0A9667C3F83564E6C399

query I
SELECT to_hex(blake3(v::ubigint order by v)) from (select * as v from range(10) as v);
----
B7EB265268D07380F973FD55964999122BE45F44D26E559FD0646FF9CB215461

query I
SELECT to_hex(blake3(v::float order by v)) from (select * as v from range(5) as v);
----
292A30693DEF5331FF8D046035A145AECE737F8AB2F9EE03D3A12BA46DE05800

query I
SELECT to_hex(blake3(v::double order by v)) from (select * as v from range(5) as v);
----
02A615BE32BCB46852128F4B30213631CC23C2C562BD688C4EB2BE524B97EEAC

query I
SELECT to_hex(blake3(v::hugeint order by v)) from (select * as v from range(5) as v);
----
6D0123541F76022789E08AC8EFC5FD044863DB4DA405CAB4B6F03FE55E6F3488
